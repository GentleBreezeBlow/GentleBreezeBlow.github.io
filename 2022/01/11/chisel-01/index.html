<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="chisel_01, Hexo">
    <meta name="description" content="Chisel学习.一Constructing Hardware In a Scala Embedded Language
注意Chisel更准确地说是寄宿在Scala里的语言，本质依旧是Scala，可以理解为在Scala上创建了Chisel">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>chisel_01 | Hexo</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Hexo</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Hexo</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/18.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">chisel_01</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Chisel/">
                                <span class="chip bg-color">Chisel</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-01-11
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Chisel学习-一"><a href="#Chisel学习-一" class="headerlink" title="Chisel学习.一"></a>Chisel学习.一</h1><p>Constructing Hardware In a Scala Embedded Language</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>Chisel更准确地说是寄宿在Scala里的语言，本质依旧是Scala，可以理解为在Scala上创建了Chisel相关的库文件，而库文件里有Chisel自定义的与硬件相关的内容。因此每个Chisel文件都需要声明<code>import chisel3._</code>，对于某些高级语法，还需要导入<code>import chisel3.util._</code>、<code>import chisel3.experimental._</code>等。</p>
<p>区分<strong>哪些代码是Scala，哪些是Chisel</strong>很重要。</p>
<p>Chisel不支持四态逻辑的x和z，只支持0和1。如果确实需要，可以通过黑盒语法与外部的Verilog代码互动，也可以在下游工具链里添加四态逻辑。</p>
<p>Chisel会对未被驱动的输出型端口和线网进行检测，如果存在，会进行报错。报错选项可以关闭和打开，取决于读者对设计模型的需求。推荐把该选项打开，尽量不要残留无用的声明。</p>
<p>Chisel模块声明时不包括Clock和Reset，这些信号是隐式生成的，在大部分设计中处理这些底层细节是不方便的，Chisel提供的寄存器如果需要，会自动连接Clock和Reset。Chisel 3.2.0开始，已经支持异步复位。</p>
<h2 id="一个简单例子"><a href="#一个简单例子" class="headerlink" title="一个简单例子"></a>一个简单例子</h2><p>在编写chisel文件夹里一般有两个主要的文件夹，src/main/scala是电路实现功能的Scala文件，src/test/scala是测试以及生成Verilog功能的Scala文件。</p>
<p>以与门为例，src/main/scala创建AND.scala：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// AND.scala</span>
<span class="token keyword">package</span> <span class="token namespace">test</span>
 
<span class="token keyword">import</span> <span class="token namespace">chisel3<span class="token punctuation">.</span></span>_
<span class="token keyword">import</span> <span class="token namespace">chisel3<span class="token punctuation">.</span>experimental<span class="token punctuation">.</span></span>_
 
<span class="token keyword">class</span> AND <span class="token keyword">extends</span> RawModule <span class="token punctuation">&#123;</span>
  <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">&#123;</span>
    <span class="token keyword">val</span> a <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> b <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> c <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 
  io<span class="token punctuation">.</span>c <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>a <span class="token operator">&amp;</span> io<span class="token punctuation">.</span>b
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>src/main/scala创建ANDtest.scala:</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// ANDtest.scala</span>
<span class="token keyword">package</span> <span class="token namespace">test</span>
 
<span class="token keyword">import</span> <span class="token namespace">chisel3<span class="token punctuation">.</span></span>_
 
<span class="token keyword">object</span> testMain <span class="token keyword">extends</span> App <span class="token punctuation">&#123;</span>
  Driver<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token keyword">new</span> AND<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行命令<code>sbt &quot;test:runMain test.testMain --target-dir generated/and&quot;</code>就会在当前路径生成一个generated文件夹，里面有一个and文件夹。生成的AND.v代码：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">AND</span><span class="token punctuation">(</span>
     <span class="token keyword">input</span>   io_a<span class="token punctuation">,</span>
     <span class="token keyword">input</span>   io_b<span class="token punctuation">,</span>
     <span class="token keyword">output</span>  io_c
<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">assign</span> io_c <span class="token operator">=</span> io_a <span class="token operator">&amp;</span> io_b<span class="token punctuation">;</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>Chisel自定义的数据类型不同于Scala的类型，构建硬件电路需要用Chisel自定义数据类型。</p>
<p><img src="D:\清风\Study\HexoData\type_hierarchy.svg" alt="Chisel基本数据类型"></p>
<p>Chisel提供了三种数据类型用来描述信号(signals)，组合逻辑(combinational logic)，和寄存器(registers)：<code>Bits</code>，<code>UInt</code>和<code>SInt</code>。<code>UInt</code>和<code>SInt</code>是<code>Bits</code>的拓展，并且所有的三种类型代表bits的矢量。<code>UInt</code>表示这个bits的矢量是一个无符号的整型，<code>SInt</code>表示一个有符号的整型。以下是不同类型的定义：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">Bits<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span>				<span class="token comment">// 8位Bits</span>
UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span>				<span class="token comment">// 8位无符号整型</span>
SInt<span class="token punctuation">(</span><span class="token number">10.</span>W<span class="token punctuation">)</span>				<span class="token comment">// 10位有符号整型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>UInt</code>、<code>SInt</code>、<code>Bits</code>的矢量宽度被Chisel的<code>Width</code>类型定义：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">Bits<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span>				<span class="token comment">// 宽度为1的Bits类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>字面量可以通过Scala定义并转为Chisel类型：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token number">1.</span>U                		<span class="token comment">// 字面值为“1”的UInt对象</span>
<span class="token operator">-</span><span class="token number">8.</span>S               		<span class="token comment">// 字面值为“-8”的SInt对象</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>其实这也是Scala中的隐式转换，Chisel定义了一系列隐式类用于类型转换：<code>fromBigIntToLiteral</code>、<code>fromIntToLiteral</code>、<code>fromLongToLiteral</code>、<code>fromStringToLiteral</code>、<code>fromBooleanToLiteral</code>等，具体请看API：<a target="_blank" rel="noopener" href="https://www.chisel-lang.org/api/3.5.0/chisel3/index.html">Chisel_API</a>。</p>
<p>以隐式类<code>fromIntToLiteral</code>为例，存在一个同名的隐式转换，把相应的Scala的<code>Int</code>对象转换成一个<code>fromIntToLiteral</code>的对象。</p>
<p><img src="D:\清风\Study\HexoData\image-20220116162436417.png" alt="fromIntToLiteral"></p>
<p>而<code>fromIntToLiteral</code>类有两个方法<code>U</code>和<code>S</code>，分别构造一个等值的<code>UInt</code>对象和<code>SInt</code>对象。再加上Scala的基本值类都是用字面量构造对象，所以要表示一个<code>UInt</code>对象，可以写成<code>1.U</code>的格式，这样编译器会插入隐式转换，变成<code>fromIntToLiteral(1).U</code>，进而构造出字面值为<code>1</code>的<code>UInt</code>对象。同理，也可以构造<code>SInt</code>。还有相同行为的方法<code>asUInt</code>和<code>asSInt</code>目前已被官方不推荐，未来很有可能会删除。</p>
<p>字面量同样可以使用<code>Width</code>类型来定义宽度，默认会按字面值取最小宽度：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token number">8.</span>U<span class="token punctuation">(</span><span class="token number">4.</span>W<span class="token punctuation">)</span>			<span class="token comment">// 一个4位的常量8</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>因此要注意<code>8.U</code>和<code>4.W</code>这种表达方式，可以认为它是一个整型常量附带一个类型，类似于Scala中的<code>8L</code>，代表长整型。这样就可能会导致犯错，例如<code>1.U(32)</code>不会定义一个32位宽的代表1的常量，相反，表达式<code>(32)</code>会被翻译为从32位抓取数值，结果是一个常量0。</p>
<p>对于其他进制的字面量，可以使用字符串来定义，十六进制是h，八进制是o，二进制是b，字面量可以用下划线间隔，下划线是被忽略的。以下例子都是常量255的定义，并且省略位宽，由Chisel自动推断。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token string">"hff"</span><span class="token punctuation">.</span>U
<span class="token string">"o377"</span><span class="token punctuation">.</span>U
<span class="token string">"b1111_1111"</span><span class="token punctuation">.</span>U<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Chisel定义了<code>Bool</code>类型来表示逻辑true或false，<code>Bool</code>类型通过<code>Boolean</code>类型的字面量——true和false——来构造<code>fromBooleanToLiteral</code>类型的对象，然后调用名为<code>B</code>的方法进一步构造<code>Bool</code>类型的对象：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token boolean">true</span><span class="token punctuation">.</span>B
<span class="token boolean">false</span><span class="token punctuation">.</span>B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>对于<code>UInt</code>，可以构成任意位宽的线网或寄存器。对于<code>SInt</code>，在Chisel里会按补码解读，转换成Verilog后会使用系统函数<code>$signed</code>，这是可综合的。对于<code>Bool</code>，转换成Verilog后就是1bit的线网或寄存器。</p>
<p>有字面量的数据类型(如<code>1.U(32.W)</code>)用于赋值、初始化寄存器等操作，而无字面量的数据类型(<code>UInt(32.W)</code>)则多用于声明端口、构造向量等。</p>
<p>现在再回到Chisel数据类型的结构图，这些数据类型都继承自抽象基类<code>Data</code>，主要包括两大子类：<strong>聚合类</strong><code>Aggregate</code>和<strong>元素类</strong><code>Element</code>。</p>
<p><strong>聚合类</strong>：常用子类是向量类<code>Vec</code>和包裹类<code>Bundle</code>。</p>
<ul>
<li><code>Vec</code>类用于包含相同的元素，元素类型可以是任意的Data子类。因为<code>Vec</code>混入了特质<code>IndexedSeq[T]</code>，所以向量的元素能从<strong>下标0</strong>开始索引访问。</li>
<li><code>Bundle</code>类用于被自定义的类继承，这样自定义的类就能包含任意Data的子类对象，常用于协助构造模块的端口，故而衍生出了一些预定义的端口子类。</li>
</ul>
<p><strong>元素类</strong>：衍生出了<code>Analog</code>、<code>Bits</code>和<code>Clock</code>三个子类，单例对象<code>DontCare</code>和特质<code>Reset</code>。</p>
<ul>
<li><code>Analog</code>用于在黑盒中模拟inout端口，目前在实际Chisel里并无其他用途。</li>
<li><code>Bits</code>类的两个子类<code>SInt</code>和<code>UInt</code>是最常用的两个数据类型，它们是用补码表示的有符号整数和无符号整数。不仅用来协助定义端口位宽，还用来进行赋值。</li>
<li><code>FixedPoint</code>类提供的API带有试验性质，而且将来可能会发生改变，所以不常用。</li>
<li><code>Bool</code>类是Chisel自己的布尔类型，<strong>区别于Scala的Boolean</strong>。<code>Bool</code>类是<code>UInt</code>类的子类，因为它可以看成是1bit的<code>UInt</code>，而且它被混入<code>Reset</code>特质，因为复位信号都是用<code>Bool</code>类型的线网或寄存器使能的。此外，<code>Bits</code>类混入了特质<code>ToBoolable</code>，也就是说<code>FixedPoint</code>、<code>SInt</code>和<code>UInt</code>都能转换成多bit的<code>Bool</code>类型。</li>
<li><code>Clock</code>类表示时钟，<strong>Chisel里的时钟是专门的一个类型</strong>，并不像Verilog里那样是1bit的线网。复位特质<code>Reset</code>也是如此。</li>
<li>单例对象<code>DontCare</code>用于赋值给未驱动的端口或线网，防止编译器报错。</li>
</ul>
<p>Chisel常用的类型就五种：<code>UInt</code>、<code>SInt</code>、<code>Bool</code>、<code>Bundle</code>和<code>Vec[T]</code>。</p>
<h3 id="向量和混合向量"><a href="#向量和混合向量" class="headerlink" title="向量和混合向量"></a>向量和混合向量</h3><p><code>Vec</code>是Chisel专属的集合类型，T必须是Data的子类，而且每个元素的类型、位宽必须一致。使用向量或其他Scala的集合时要仔细考虑，一般只在定义寄存器或端口时用来表示硬件集合。</p>
<p>API信息：</p>
<blockquote>
<p>def apply[T &lt;: Data](n: Int, gen: T)</p>
<p>(<em>implicit</em> sourceInfo: SourceInfo, compileOptions: CompileOptions): Vec[T]</p>
<p>Creates a new Vec with <code>n</code> entries of the specified data type.</p>
</blockquote>
<p>由信息可知，向量定义了一个apply工厂方法，接收两个参数，第一个表示元素个数，第二个是元素。向量<strong>下标从0开始</strong>。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">Vec<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<p><code>VecInit</code>通过接收一个<code>Seq</code>(Seq是包括Seq、Array、List、Tuple等集合)作为参数来构造向量，或是多个重复参数。常把有字面量的数据作为参数，用于初始化寄存器组、ROM、RAM等，或用来构造多个模块。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">VecInit<span class="token punctuation">(</span><span class="token number">1.</span>U<span class="token punctuation">,</span> <span class="token number">2.</span>U<span class="token punctuation">,</span> <span class="token number">3.</span>U<span class="token punctuation">,</span> <span class="token number">4.</span>U<span class="token punctuation">)</span>				<span class="token comment">//重复参数</span>
VecInit<span class="token punctuation">(</span>Seq<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>			<span class="token comment">//序列</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<p><code>MixedVec</code>是混合向量，与普通向量<code>Vec</code>类似，但其包含的元素可以不全都一样，比如位宽不一样。与向量类似，也有一个名为<code>MixedVecInit</code>的类型可以接收重复参数或序列。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">MixedVec<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">16.</span>W<span class="token punctuation">)</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>				<span class="token comment">//重复参数</span>
MixedVec<span class="token punctuation">(</span>Array<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">16.</span>W<span class="token punctuation">)</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>		<span class="token comment">//序列</span>
MixedVec<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">)</span> map <span class="token punctuation">(</span>i <span class="token keyword">=></span> UInt<span class="token punctuation">(</span>i<span class="token punctuation">.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>				<span class="token comment">//序列</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>上例最后一行代码会生成十个<code>UInt</code>类型的宽度<code>Width</code>从1依次增加至10的集合，如果是生成寄存器，那么会生成<code>reg_0</code>、<code>[1:0] reg_1</code>、……、<code>[9:0] reg_9</code>。</p>
<p>Scala中的map、flatMap、zip、foreach、filter、exists、contains等方法虽然是软件层面，但也可以用于简化硬件逻辑的编写。</p>
<p><code>Vec</code>和<code>MixedVec</code>传入的是数据类型，而<code>VecInit</code>和<code>MixedVecInit</code>传入的是硬件类型。</p>
<blockquote>
<p>Vec和MixedVec定义的时候，最好不要直接给确切的值，只需要给出Chisel type，之后再给元素单独赋值即可，如上面的<code>UInt(32.W)</code>即可，否则会报错。原因是：Vec接收的是数据类型，而带字面量的数据如**<code>1.U</code>会被认为是硬件类型**，就会报错。</p>
<p>同样，VecInit和MixedVecInit必须给出确切的初始化的值，不能只给Chisel type。原因是：VecInit接收的是硬件类型，而Chisel type如<code>UInt(32.W)</code>是数据类型，如果传入就会报错。</p>
</blockquote>
<p>索引时需要多个括号：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> myVec <span class="token operator">=</span> Reg<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

myVec<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment">//索引vec第一个元素的第6个bit</span>

myVec<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//索引vec第一个元素的低4位</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="包裹Bundle"><a href="#包裹Bundle" class="headerlink" title="包裹Bundle"></a>包裹Bundle</h3><p>抽象类<code>Bundle</code>很像C语言中的结构体，用户可以编写一个自定义类来继承自它，然后在自定义的类里包含其它各种Data类型的字段。它可以协助构建线网或寄存器。但最常见的用途是用于构建一个模块的端口列表或一部分端口：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span> MyModule <span class="token keyword">extends</span> Module <span class="token punctuation">&#123;</span>
   <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">&#123;</span>
       <span class="token keyword">val</span> in <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token keyword">val</span> out <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>Bundle</code>可以和<code>UInt</code>相互转换，<code>Bundle</code>类有一个方法<code>asUInt</code>，可以把所含的字段拼接成一个<code>UInt</code>数据，并且前面的字段在高位。<code>asTypeOf</code>方法将<code>UInt</code>转换成<code>Bundle</code>类型。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span> MyBundle <span class="token keyword">extends</span> Bundle <span class="token punctuation">&#123;</span>
   <span class="token keyword">val</span> foo <span class="token operator">=</span> UInt<span class="token punctuation">(</span><span class="token number">4.</span>W<span class="token punctuation">)</span>  <span class="token comment">// 高位</span>
   <span class="token keyword">val</span> bar <span class="token operator">=</span> UInt<span class="token punctuation">(</span><span class="token number">4.</span>W<span class="token punctuation">)</span>  <span class="token comment">// 低位</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">val</span> bundle <span class="token operator">=</span> Wire<span class="token punctuation">(</span><span class="token keyword">new</span> MyBundle<span class="token punctuation">)</span>
bundle<span class="token punctuation">.</span>foo <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">0xc</span><span class="token punctuation">.</span>U
bundle<span class="token punctuation">.</span>bar <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">0x3</span><span class="token punctuation">.</span>U
<span class="token keyword">val</span> uint <span class="token operator">=</span> bundle<span class="token punctuation">.</span>asUInt  <span class="token comment">// 12*16 + 3 = 195</span>

<span class="token keyword">val</span> uintTwo <span class="token operator">=</span> <span class="token number">0xb4</span><span class="token punctuation">.</span>U
<span class="token keyword">val</span> bundleTwo <span class="token operator">=</span> uintTwo<span class="token punctuation">.</span>asTypeOf<span class="token punctuation">(</span><span class="token keyword">new</span> MyBundle<span class="token punctuation">)</span>  <span class="token comment">// foo = 11, bar = 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="内建操作符"><a href="#内建操作符" class="headerlink" title="内建操作符"></a>内建操作符</h2><p>需要注意的是，由于“==”和“!=”已经被Scala占有，所以Chisel另设了两个新的操作符用来比较相等性——“===”和“=/=”。</p>
<table>
<thead>
<tr>
<th align="center">操作符</th>
<th align="center">释义</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>位操作符</strong></td>
<td align="center"><strong>作用类型：SInt, UInt, Bool</strong></td>
</tr>
<tr>
<td align="center">~</td>
<td align="center">位取反</td>
</tr>
<tr>
<td align="center">&amp;</td>
<td align="center">位与</td>
</tr>
<tr>
<td align="center">|</td>
<td align="center">位或</td>
</tr>
<tr>
<td align="center">^</td>
<td align="center">位异或</td>
</tr>
<tr>
<td align="center"><strong>缩减位</strong></td>
<td align="center"><strong>作用类型：SInt, UInt 返回类型：Bool</strong></td>
</tr>
<tr>
<td align="center">x.andR</td>
<td align="center">缩减与</td>
</tr>
<tr>
<td align="center">x.orR</td>
<td align="center">缩减或</td>
</tr>
<tr>
<td align="center">x.xorR</td>
<td align="center">缩减异或</td>
</tr>
<tr>
<td align="center"><strong>相等性</strong></td>
<td align="center"><strong>作用类型：SInt, UInt, Bool 返回类型：Bool</strong></td>
</tr>
<tr>
<td align="center">===</td>
<td align="center">相等</td>
</tr>
<tr>
<td align="center">=/=</td>
<td align="center">不相等</td>
</tr>
<tr>
<td align="center"><strong>移位</strong></td>
<td align="center"><strong>作用类型：SInt, UInt</strong></td>
</tr>
<tr>
<td align="center">&lt;&lt;</td>
<td align="center">逻辑左移</td>
</tr>
<tr>
<td align="center">&gt;&gt;</td>
<td align="center">右移(UInt逻辑右移，SInt算术右移)</td>
</tr>
<tr>
<td align="center"><strong>逻辑操作符</strong></td>
<td align="center"><strong>作用类型：Bool</strong></td>
</tr>
<tr>
<td align="center">!</td>
<td align="center">逻辑非</td>
</tr>
<tr>
<td align="center">&amp;&amp;</td>
<td align="center">逻辑与</td>
</tr>
<tr>
<td align="center">||</td>
<td align="center">逻辑或</td>
</tr>
<tr>
<td align="center"><strong>算术操作符</strong></td>
<td align="center"><strong>作用类型：Sint, UInt</strong></td>
</tr>
<tr>
<td align="center">+ (or +%)</td>
<td align="center">加法(不进行宽度扩展)</td>
</tr>
<tr>
<td align="center">+&amp;</td>
<td align="center">加法(扩展一位进位位)</td>
</tr>
<tr>
<td align="center">- (or -%)</td>
<td align="center">减法(不进行宽度扩展)</td>
</tr>
<tr>
<td align="center">-&amp;</td>
<td align="center">减法(扩展一位进位位)</td>
</tr>
<tr>
<td align="center">*</td>
<td align="center">乘法</td>
</tr>
<tr>
<td align="center">/</td>
<td align="center">除法</td>
</tr>
<tr>
<td align="center">%</td>
<td align="center">求余</td>
</tr>
<tr>
<td align="center"><strong>算术比较符</strong></td>
<td align="center"><strong>作用类型：SInt, UInt 返回类型：Bool</strong></td>
</tr>
<tr>
<td align="center">&gt;</td>
<td align="center">大于</td>
</tr>
<tr>
<td align="center">&gt;=</td>
<td align="center">大于等于</td>
</tr>
<tr>
<td align="center">&lt;</td>
<td align="center">小于</td>
</tr>
<tr>
<td align="center">&lt;=</td>
<td align="center">小于等于</td>
</tr>
</tbody></table>
<h3 id="硬件赋值"><a href="#硬件赋值" class="headerlink" title="硬件赋值"></a>硬件赋值</h3><p>只有数据类型是无法构成电路的，在Verilog中主要有wire和reg两种硬件类型，然后用赋值操作进行信号传递或硬件的连线等操作。但Chisel中所有对象都由val类型变量来定义，而Scala中无法对已经定义的val类型变量重新赋值，也就是“=”已经不可用。但Scala中的val类型变量是指定的对象不可更改，但这个对象本身可以被更改。</p>
<p>为解决这个问题，Chisel定义了操作符“**:=**”作为等同于Verilog中的赋值操作。所以编写Chisel代码中要明白，对于寄存器等的声明要用Scala中的“=”操作符，而声明之后所有的硬件赋值操作都要使用“:=”操作符。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> x <span class="token operator">=</span> Wire<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">4.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
x <span class="token operator">:</span><span class="token operator">=</span> <span class="token string">"b1010"</span><span class="token punctuation">.</span>U  <span class="token comment">// 向4bit的线网x赋予了无符号数10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="内建控制结构"><a href="#内建控制结构" class="headerlink" title="内建控制结构"></a>内建控制结构</h2><h3 id="when条件句"><a href="#when条件句" class="headerlink" title="when条件句"></a>when条件句</h3><p>由于Scala已经占用了“if……else……”语法，Chisel自建了对应的控制结构，语法如下：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">when <span class="token punctuation">(</span>condition <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> definition <span class="token number">1</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">.</span>elsewhen <span class="token punctuation">(</span>condition <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> definition <span class="token number">2</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span>elsewhen <span class="token punctuation">(</span>condition N<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> definition N <span class="token punctuation">&#125;</span>
<span class="token punctuation">.</span>otherwise <span class="token punctuation">&#123;</span> default behavior <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意，<code>.elsewhen</code>和<code>.otherwise</code>的开头有两个句点。所有的判断条件都是返回<code>Bool</code>类型的传名参数，不要和Scala的<code>Boolean</code>类型混淆，也不存在<code>Boolean</code>和<code>Bool</code>之间的相互转换。对于<code>UInt</code>、<code>SInt</code>，甚至是<code>Clock</code>和<code>Reset</code>类型，可以用方法<code>asBool</code>转换成<code>Bool</code>类型来作为判断条件。</p>
<p>when语句不仅可以给线网赋值，还可以给寄存器赋值，但是要注意构建组合逻辑时不能缺失<code>.otherwise</code>分支。 下面是一个简单的寻找三个数中的最大值的模块：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span> Max3 <span class="token keyword">extends</span> Module <span class="token punctuation">&#123;</span>
  <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">&#123;</span>
    <span class="token keyword">val</span> in1 <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">16.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> in2 <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">16.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> in3 <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">16.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> out <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">16.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    
  when<span class="token punctuation">(</span>io<span class="token punctuation">.</span>in1 <span class="token operator">>=</span> io<span class="token punctuation">.</span>in2 <span class="token operator">&amp;&amp;</span> io<span class="token punctuation">.</span>in1 <span class="token operator">>=</span> io<span class="token punctuation">.</span>in3<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    io<span class="token punctuation">.</span>out <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in1  
  <span class="token punctuation">&#125;</span><span class="token punctuation">.</span>elsewhen<span class="token punctuation">(</span>io<span class="token punctuation">.</span>in2 <span class="token operator">>=</span> io<span class="token punctuation">.</span>in3<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    io<span class="token punctuation">.</span>out <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in2 
  <span class="token punctuation">&#125;</span><span class="token punctuation">.</span>otherwise <span class="token punctuation">&#123;</span>
    io<span class="token punctuation">.</span>out <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in3
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>when有很多场合可以使用：比如使用when给带使能信号的寄存器更新数据；还可用于状态机的状态转换。除了when结构，util包里还有一个与之对偶的结构<code>unless</code>，如果unless的判定条件为<code>false.B</code>则一直执行，否则不执行：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">import</span> <span class="token namespace">chisel3<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>_

unless <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> definition <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="端口IO"><a href="#端口IO" class="headerlink" title="端口IO"></a>端口IO</h2><p>类似于Verilog中的input、output。</p>
<h3 id="定义端口"><a href="#定义端口" class="headerlink" title="定义端口"></a>定义端口</h3><p>整个端口列表是由方法<code>IO[T &lt;: Data](iodef: T)</code>来定义的，通常其参数是一个<code>Bundle</code>类型的对象，而且引用的字段名称<strong>必须</strong>是<code>io</code>。因为端口存在方向，所以还需要方法<code>Input[T &lt;: Data](source: T)</code>和<code>Output[T &lt;: Data](source: T)</code>来为每个端口表明具体的方向。注意Input和Output仅仅是复制它们的参数，所以不能是已经被硬件类型包裹的数据类型。因为字段名称是<code>io</code>，生成的Verilog代码中端口都会有<code>io_</code>的前缀。</p>
<p>目前Chisel<strong>不支持双向端口inout</strong>，只能通过Analog端口来模拟外部Verilog的双向端口。</p>
<p>一旦端口列表定义完成，就可以通过<code>io.xxx</code>来使用。输入可以驱动内部其它信号，输出可以被其他信号驱动。可以直接进行赋值操作，布尔类型的端口还能直接作为使能信号。端口不需要再使用其它硬件类型来定义，不过要注意从性质上来说它仍然属于组合逻辑的线网。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span> MyIO <span class="token keyword">extends</span> Bundle <span class="token punctuation">&#123;</span>
   <span class="token keyword">val</span> in <span class="token operator">=</span> Input<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">val</span> out <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
……
   <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> MyIO<span class="token punctuation">)</span>  <span class="token comment">// 模块的端口列表</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="翻转端口方向"><a href="#翻转端口方向" class="headerlink" title="翻转端口方向"></a>翻转端口方向</h3><p>对于两个相连的模块，可能存在大量同名但方向相反的端口。仅仅为了翻转方向而不得不重写一遍端口显得费时费力，所以Chisel提供了<code>Flipped[T &lt;: Data](source: T)</code>方法，可以把参数里所有的输入转输出，输出转输入。如果是黑盒里的Analog端口，则仍是双向的。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"> <span class="token keyword">class</span> MyIO <span class="token keyword">extends</span> Bundle <span class="token punctuation">&#123;</span>
   <span class="token keyword">val</span> in <span class="token operator">=</span> Input<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">val</span> out <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
……
   <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> MyIO<span class="token punctuation">)</span>  <span class="token comment">// in是输入，out是输出</span>

   <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span>Flipped<span class="token punctuation">(</span><span class="token keyword">new</span> MyIO<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// out是输入，in是输出</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="整体连接"><a href="#整体连接" class="headerlink" title="整体连接"></a>整体连接</h3><p>翻转方向的端口列表通常配合整体连接符号<code>&lt;&gt;</code>使用。该操作符会把左右两边的端口列表里所有同名的端口进行连接，而且同一级的端口方向必须是输入连输出、输出连输入，父级和子级的端口方向则是输入连输入、输出连输出。注意，方向必须按这个规则匹配，而且不能存在端口名字、数量、类型不同的情况。这样就省去了大量连线的代码。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span> MyIO <span class="token keyword">extends</span> Bundle <span class="token punctuation">&#123;</span>
   <span class="token keyword">val</span> in <span class="token operator">=</span> Input<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">val</span> out <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
……
   <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">&#123;</span>
       <span class="token keyword">val</span> x <span class="token operator">=</span> <span class="token keyword">new</span> MyIO       
       <span class="token keyword">val</span> y <span class="token operator">=</span> Flipped<span class="token punctuation">(</span><span class="token keyword">new</span> MyIO<span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

   io<span class="token punctuation">.</span>x <span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span> io<span class="token punctuation">.</span>y  <span class="token comment">// 相当于 io.y.in := io.x.in; io.x.out := io.y.out </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="模块Module"><a href="#模块Module" class="headerlink" title="模块Module"></a>模块Module</h2><p>类似于Verilog中的module。</p>
<h3 id="定义模块"><a href="#定义模块" class="headerlink" title="定义模块"></a>定义模块</h3><p>在Chisel里面是用一个自定义的类来定义模块的，这个类有以下三个特点：</p>
<p>①继承自Module类、RawModule类等。</p>
<p>②有一个抽象字段<code>io</code>需要实现，该字段必须引用前面所说的端口对象。</p>
<p>③在类的主构造器里进行内部电路连线。</p>
<p>因为非字段、非方法的内容都属于主构造方法，所以用操作符<code>:=</code>进行的赋值、用<code>&lt;&gt;</code>进行的连线或一些控制结构等等，都属于主构造方法。从Chisel的层面来讲，它们就是在声明如何进行模块内部子电路的连接、信号的传递，类似于Verilog的assign和always语句。</p>
<p>再回到简单的例子AND，这个类继承自RawModule类，而且端口的声明是声明一个匿名类继承自Bundle，然后实例化该匿名类。对于短小、简单的端口列表，可以使用这种简便写法。对于大的公用接口，应该单独写成具名的Bundle子类，方便修改。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// AND.scala</span>
<span class="token keyword">package</span> <span class="token namespace">test</span>
 
<span class="token keyword">import</span> <span class="token namespace">chisel3<span class="token punctuation">.</span></span>_
<span class="token keyword">import</span> <span class="token namespace">chisel3<span class="token punctuation">.</span>experimental<span class="token punctuation">.</span></span>_
 
<span class="token keyword">class</span> AND <span class="token keyword">extends</span> RawModule <span class="token punctuation">&#123;</span>
  <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">&#123;</span>
    <span class="token keyword">val</span> a <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> b <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> c <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 
  io<span class="token punctuation">.</span>c <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>a <span class="token operator">&amp;</span> io<span class="token punctuation">.</span>b
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="模块例化"><a href="#模块例化" class="headerlink" title="模块例化"></a>模块例化</h3><p>要例化一个模块，并不是直接用new生成一个实例对象就完成了，还需要再把实例的对象传递给单例对象Module的apply方法。这种别扭的语法是Scala的语法限制造成的，就像端口需要写成<code>IO(new Bundle &#123;…&#125;)</code>，无符号数要写成<code>UInt(n.W)</code>等等一样。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> m0 <span class="token operator">=</span> Module<span class="token punctuation">(</span><span class="token keyword">new</span> Mux2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>对于要多次例化的重复模块，可以利用向量的工厂方法<code>VecInit[T &lt;: Data]</code>。因为该方法接收的参数类型是Data的子类，而模块的字段io正好是Bundle类型，并且实际的电路连线仅仅只需针对模块的端口，所以可以把待例化模块的io字段组成一个序列，或者按重复参数的方式作为参数传递。通常使用序列作为参数，这样更节省代码。生成序列的一种方法是调用单例对象Seq里的方法fill，该方法的一个重载版本有两个单参数列表，第一个接收Int类型的对象，表示序列的元素个数，第二个是传名参数，接收序列的元素。</p>
<p>多个例化模块时Vec中的元素因为必须是Data的子类，因此元素<strong>必须是模块的端口字段io</strong>，这样的话在引用例化模块的具体端口时，<strong>路径里就不能再出现io</strong>。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// mux4_2.scala</span>
<span class="token keyword">package</span> <span class="token namespace">test</span>
 
<span class="token keyword">import</span> <span class="token namespace">chisel3<span class="token punctuation">.</span></span>_
<span class="token keyword">class</span> Mux4_2 <span class="token keyword">extends</span> Module <span class="token punctuation">&#123;</span>
  <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">&#123;</span>
    <span class="token keyword">val</span> in0 <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> in1 <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> in2 <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> in3 <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sel <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">2.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> out <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token comment">// 例化了三个Mux2，并且参数是端口字段io</span>
  <span class="token keyword">val</span> m <span class="token operator">=</span> VecInit<span class="token punctuation">(</span>Seq<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Module<span class="token punctuation">(</span><span class="token keyword">new</span> Mux2<span class="token punctuation">)</span><span class="token punctuation">.</span>io<span class="token punctuation">)</span><span class="token punctuation">)</span>  
  m<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sel <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>sel<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// 模块的端口通过下标索引，并且路径里没有“io”</span>
  m<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>in0 <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in0
  m<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>in1 <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in1
  m<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sel <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>sel<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  m<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>in0 <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in2
  m<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>in1 <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in3
  m<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sel <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>sel<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  m<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>in0 <span class="token operator">:</span><span class="token operator">=</span> m<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>out
  m<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>in1 <span class="token operator">:</span><span class="token operator">=</span> m<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>out
  io<span class="token punctuation">.</span>out <span class="token operator">:</span><span class="token operator">=</span> m<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>out
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Module模块类"><a href="#Module模块类" class="headerlink" title="Module模块类"></a>Module模块类</h3><p>我们在大多数情况下自定义的模块都是继承自<code>Module</code>，但其实还有两种常用的module，分别是<code>MultiIOModule</code>和<code>RawModule</code>。</p>
<p><strong>MultiIOModule</strong>：它没有抽象字段<code>io</code>需要实现，所以允许根据需要只定义多个不同的IO，而不需要像前面介绍的那样必须实现抽象成员<code>io</code>(但也允许采用和<code>Module</code>一样的端口定义形式)。而且从<code>MultiIOModule</code>生成的Verilog中的端口信号没有io_前缀。<code>MultiIOModule</code>也有隐式的时钟和复位信号。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// mux2.scala</span>
<span class="token keyword">import</span> <span class="token namespace">chisel3<span class="token punctuation">.</span></span>_

<span class="token keyword">class</span> Mux2 <span class="token keyword">extends</span> MultiIOModule <span class="token punctuation">&#123;</span>

    <span class="token keyword">val</span> sel <span class="token operator">=</span> IO<span class="token punctuation">(</span>Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> in0 <span class="token operator">=</span> IO<span class="token punctuation">(</span>Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> in1 <span class="token operator">=</span> IO<span class="token punctuation">(</span>Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> out <span class="token operator">=</span> IO<span class="token punctuation">(</span>Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    out <span class="token operator">:</span><span class="token operator">=</span> <span class="token punctuation">(</span>sel <span class="token operator">&amp;</span> in1<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>sel <span class="token operator">&amp;</span> in0<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>写法的优点在于可以很方便的在程序中增加一个或者多个端口，因为你现在只需要简单的定义一个任意变量名的变量即可，不再需要将端口放在<code>io</code>字段中，也不需要再使用<code>Bundle</code>。</p>
<p><strong>RawModule</strong>：与<code>MultiIOModule</code>相比在定义IO时是类似的，也可以采用上述格式。更重要的是，<code>RawModule</code><strong>没有隐式的时钟和复位信号</strong>，因此它多用于多时钟域设计中。</p>
<h2 id="线网Wire"><a href="#线网Wire" class="headerlink" title="线网Wire"></a>线网Wire</h2><p>类似于Verilog中组合逻辑用的wire。</p>
<p>Chisel把线网作为电路的节点，通过工厂方法<code>Wire[T &lt;: Data](t: T)</code>来定义。可以对线网进行赋值，也可以连接到其他电路节点，这是组成组合逻辑的基本硬件类型。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> w0 <span class="token operator">=</span> Wire<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// width is inferred</span>
<span class="token keyword">val</span> w1 <span class="token operator">=</span> Wire<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// width is set to 8</span>

<span class="token keyword">val</span> w2 <span class="token operator">=</span> Wire<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// width is inferred</span>
<span class="token keyword">val</span> w3 <span class="token operator">=</span> Wire<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// width of each element is set to 8</span>

<span class="token keyword">class</span> MyBundle <span class="token punctuation">&#123;</span>
  <span class="token keyword">val</span> unknown <span class="token operator">=</span> UInt<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> known   <span class="token operator">=</span> UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">val</span> w4 <span class="token operator">=</span> Wire<span class="token punctuation">(</span><span class="token keyword">new</span> MyBundle<span class="token punctuation">)</span>
<span class="token comment">// Width of w4.unknown is inferred</span>
<span class="token comment">// Width of w4.known is set to 8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>例如：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> mixVec <span class="token operator">=</span> Wire<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
mixVec <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>a
io<span class="token punctuation">.</span>c <span class="token operator">:</span><span class="token operator">=</span> mixVec <span class="token operator">&amp;</span> io<span class="token punctuation">.</span>b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>生成的Verilog代码：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _GEN_0 <span class="token operator">=</span> <span class="token operator">&#123;&#123;</span><span class="token number">1'd0</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> io_a<span class="token operator">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// @[AND.scala 16:16]</span>
<span class="token keyword">assign</span> io_c <span class="token operator">=</span> _GEN_0 <span class="token operator">&amp;</span> io_b<span class="token punctuation">;</span> <span class="token comment">// @[AND.scala 16:16]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>注意，<code>Wire</code>当中可包裹<code>Vec</code>或<code>MixedVec</code>，但不能包裹<code>VecInit</code>或<code>MixedVecInit</code>，因为它们传入的是硬件类型，返回的也是硬件类型，但<code>Wire</code>必须传入数据类型。</p>
<p>另外，一旦被Wire包裹，必须提供初始值，也即必须被驱动，至少要赋个<code>DontCare</code>，否则会报错。</p>
<h2 id="寄存器Reg"><a href="#寄存器Reg" class="headerlink" title="寄存器Reg"></a>寄存器Reg</h2><p>类似于Verilog中时序逻辑中用的reg。</p>
<p>主要有五种内建的寄存器类型，以下例子均继承了<code>Module</code>类且混入了特质<code>RequireAsyncReset</code>，复位均为异步复位：</p>
<hr>
<p><strong>Reg</strong>：普通的寄存器，工厂方法<code>Reg[T &lt;: Data](t: T)</code>，传入数据类型。</p>
<p>可以进行条件赋值，也可以进行无条件赋值，<strong>默认没有复位信号</strong>；参数<code>t</code>的意思是提供一个数据类型模板，也即指定数据的类型，不用给确切的值。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> reg0 <span class="token operator">=</span> Reg<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">2.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
reg0 <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>生成的Verilog为：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg0<span class="token punctuation">;</span> <span class="token comment">// @[TEST.scala 10:15]</span>
<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clock<span class="token punctuation">)</span> <span class="token keyword">begin</span>
  reg1 <span class="token operator">&lt;=</span> io_in<span class="token punctuation">;</span> <span class="token comment">// @[TEST.scala 11:6]</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<p><strong>RegInit</strong>：带复位的寄存器，工厂方法<code>RegInit[T &lt;: Data](init: T)</code>或<code>RegInit[T &lt;: Data](t: T, init: T)</code>，传入硬件类型。</p>
<p>可以进行条件赋值，也可以无条件赋值；<strong>默认有复位信号</strong>；参数<code>t</code>的意思是提供一个数据类型模板，也即指定数据的类型，不用给确切的值。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> reg1 <span class="token operator">=</span> RegInit<span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">2.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
reg0 <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>生成Verilog为：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg1<span class="token punctuation">;</span> <span class="token comment">// @[TEST.scala 10:19]</span>
<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clock <span class="token keyword">or</span> <span class="token keyword">posedge</span> reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token comment">// @[TEST.scala 10:19]</span>
    reg1 <span class="token operator">&lt;=</span> <span class="token number">2'h0</span><span class="token punctuation">;</span> <span class="token comment">// @[TEST.scala 10:19]</span>
  <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
    reg1 <span class="token operator">&lt;=</span> io_in<span class="token punctuation">;</span> <span class="token comment">// @[TEST.scala 11:6]</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<p><strong>RegNext</strong>：跟随寄存器，工厂方法<code>RegNext[T &lt;: Data](next: T)</code>，传入硬件类型。在每个时钟上升沿，它都会采样一次传入的参数，并且没有复位信号。它的另一个版本的apply工厂方法是<code>RegNext[T &lt;: Data](next: T, init: T)</code>，也就是由复位信号控制，当复位信号有效时，复位到指定值，否则就跟随。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> reg2 <span class="token operator">=</span> RegNext<span class="token punctuation">(</span>io<span class="token punctuation">.</span>in<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>生成的Verilog为：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg2<span class="token punctuation">;</span> <span class="token comment">// @[TEST.scala 10:19]</span>
<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clock<span class="token punctuation">)</span> <span class="token keyword">begin</span>
  reg2 <span class="token operator">&lt;=</span> io_in<span class="token punctuation">;</span> <span class="token comment">// @[TEST.scala 10:19]</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看到和<code>Reg</code>作用是一致的，当有复位值时：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> reg2 <span class="token operator">=</span> RegNext<span class="token punctuation">(</span>io<span class="token punctuation">.</span>in<span class="token punctuation">,</span><span class="token number">0.</span>U<span class="token punctuation">)</span>	<span class="token comment">//in是2位的Input。注意要是0.U，而不能是0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>生成Verilog：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg2<span class="token punctuation">;</span> <span class="token comment">// @[TEST.scala 10:19]</span>
<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clock <span class="token keyword">or</span> <span class="token keyword">posedge</span> reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token comment">// @[TEST.scala 10:19]</span>
    reg2 <span class="token operator">&lt;=</span> <span class="token number">2'h0</span><span class="token punctuation">;</span> <span class="token comment">// @[TEST.scala 10:19]</span>
  <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
    reg2 <span class="token operator">&lt;=</span> io_in<span class="token punctuation">;</span> <span class="token comment">// @[TEST.scala 10:19]</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看到此时和<code>RegInit</code>作用是一致的。</p>
<hr>
<p><strong>RegEnable</strong>：util包里的带使能端的寄存器，工厂方法<code>RegEnable[T &lt;: Data](next: T, init: T, enable: Bool)</code>，如果不需要复位信号，则第二个参数可以省略给出。传入硬件类型。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> reg3 <span class="token operator">=</span> RegEnable<span class="token punctuation">(</span>io<span class="token punctuation">.</span>in<span class="token punctuation">,</span>io<span class="token punctuation">.</span>en<span class="token punctuation">)</span>	<span class="token comment">//in和en是Input</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>生成Verilog：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg3<span class="token punctuation">;</span> <span class="token comment">// @[Reg.scala 16:16]</span>
  <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clock<span class="token punctuation">)</span> <span class="token keyword">begin</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token comment">// @[Reg.scala 17:18]</span>
      reg3 <span class="token operator">&lt;=</span> io_in<span class="token punctuation">;</span> <span class="token comment">// @[Reg.scala 17:22]</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<p><strong>ShiftRegister</strong>：util包里的移位寄存器，工厂方法<code>ShiftRegister[T &lt;: Data](in: T, n: Int, resetData: T, en: Bool)</code>其中第一个参数in是带移位的数据，第二个参数n是需要延迟的周期数，第三个参数resetData是指定的复位值，可以省略，第四个参数en是使能移位的信号，默认为true.B。传入硬件类型。</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> reg4 <span class="token operator">=</span> ShiftRegister<span class="token punctuation">(</span>io<span class="token punctuation">.</span>in<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>io<span class="token punctuation">.</span>en<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>生成Verilog：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg4_r<span class="token punctuation">;</span> <span class="token comment">// @[Reg.scala 16:16]</span>
<span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg4<span class="token punctuation">;</span> <span class="token comment">// @[Reg.scala 16:16]</span>
<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clock<span class="token punctuation">)</span> <span class="token keyword">begin</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token comment">// @[Reg.scala 17:18]</span>
    reg4_r <span class="token operator">&lt;=</span> io_in<span class="token punctuation">;</span> <span class="token comment">// @[Reg.scala 17:22]</span>
  <span class="token keyword">end</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token comment">// @[Reg.scala 17:18]</span>
    reg4 <span class="token operator">&lt;=</span> reg4_r<span class="token punctuation">;</span> <span class="token comment">// @[Reg.scala 17:22]</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看出，<strong>除了Reg，其余寄存器传入的参数都必须是硬件类型，而Reg传入的参数是数据类型。</strong></p>
<hr>
<p><strong>寄存器组</strong>：上述构造寄存器的工厂方法，它们的参数可以是任何Data的子类型。如果把子类型Vec[T]或VecInit[T]作为参数传递进去，就会生成多个位宽相同、行为相同、名字前缀相同的寄存器。同样，寄存器组在Chisel代码里可以通过下标索引。例如：</p>
<pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// reg2.scala</span>
<span class="token keyword">package</span> <span class="token namespace">test</span>
 
<span class="token keyword">import</span> <span class="token namespace">chisel3<span class="token punctuation">.</span></span>_
<span class="token keyword">import</span> <span class="token namespace">chisel3<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>_
<span class="token keyword">class</span> REG2 <span class="token keyword">extends</span> Module <span class="token punctuation">&#123;</span>
  <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">&#123;</span>
    <span class="token keyword">val</span> a <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> en <span class="token operator">=</span> Input<span class="token punctuation">(</span>Bool<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> c <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">1.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> reg0 <span class="token operator">=</span> RegNext<span class="token punctuation">(</span>VecInit<span class="token punctuation">(</span>io<span class="token punctuation">.</span>a<span class="token punctuation">,</span> io<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> reg1 <span class="token operator">=</span> RegNext<span class="token punctuation">(</span>VecInit<span class="token punctuation">(</span>io<span class="token punctuation">.</span>a<span class="token punctuation">,</span> io<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> VecInit<span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">,</span> <span class="token number">0.</span>U<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> reg2 <span class="token operator">=</span> RegInit<span class="token punctuation">(</span>VecInit<span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> reg3 <span class="token operator">=</span> Reg<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> reg4 <span class="token operator">=</span> Reg<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> reg5 <span class="token operator">=</span> RegEnable<span class="token punctuation">(</span>VecInit<span class="token punctuation">(</span>io<span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token number">1.</span>U<span class="token punctuation">,</span> io<span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token number">1.</span>U<span class="token punctuation">)</span><span class="token punctuation">,</span> VecInit<span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> io<span class="token punctuation">.</span>en<span class="token punctuation">)</span>
  <span class="token keyword">val</span> reg6 <span class="token operator">=</span> RegEnable<span class="token punctuation">(</span>VecInit<span class="token punctuation">(</span>io<span class="token punctuation">.</span>a <span class="token operator">-</span> <span class="token number">1.</span>U<span class="token punctuation">,</span> io<span class="token punctuation">.</span>a <span class="token operator">-</span> <span class="token number">1.</span>U<span class="token punctuation">)</span><span class="token punctuation">,</span> io<span class="token punctuation">.</span>en<span class="token punctuation">)</span>
  <span class="token keyword">val</span> reg7 <span class="token operator">=</span> ShiftRegister<span class="token punctuation">(</span>VecInit<span class="token punctuation">(</span>io<span class="token punctuation">.</span>a<span class="token punctuation">,</span> io<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> VecInit<span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> io<span class="token punctuation">.</span>en<span class="token punctuation">)</span>
  <span class="token keyword">val</span> reg8 <span class="token operator">=</span> ShiftRegister<span class="token punctuation">(</span>VecInit<span class="token punctuation">(</span>io<span class="token punctuation">.</span>a<span class="token punctuation">,</span> io<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> io<span class="token punctuation">.</span>en<span class="token punctuation">)</span>
  
  reg2<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>a<span class="token punctuation">.</span>andR
  reg2<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>a<span class="token punctuation">.</span>andR
  reg3<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>a<span class="token punctuation">.</span>orR
  reg3<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>a<span class="token punctuation">.</span>orR
  when<span class="token punctuation">(</span>reset<span class="token punctuation">.</span>toBool<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    reg4<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">0.</span>U
    reg4<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">0.</span>U
  <span class="token punctuation">&#125;</span> <span class="token punctuation">.</span>otherwise <span class="token punctuation">&#123;</span>
    reg4<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">1.</span>U
    reg4<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">1.</span>U
  <span class="token punctuation">&#125;</span>
  io<span class="token punctuation">.</span>c <span class="token operator">:</span><span class="token operator">=</span> reg0<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg1<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg2<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg3<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg4<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg5<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg6<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg7<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg8<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>
          reg0<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg2<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg3<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg4<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg5<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg6<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg7<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> reg8<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>生成的Verilog代码：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// REG2.v</span>
<span class="token keyword">module</span> <span class="token function">REG2</span><span class="token punctuation">(</span>
  <span class="token keyword">input</span>        clock<span class="token punctuation">,</span>
  <span class="token keyword">input</span>        reset<span class="token punctuation">,</span>
  <span class="token keyword">input</span>  <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> io_a<span class="token punctuation">,</span>
  <span class="token keyword">input</span>        io_en<span class="token punctuation">,</span>
  <span class="token keyword">output</span>       io_c
<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg0_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg0_1<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg1_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg1_1<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg2_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg2_1<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg3_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg3_1<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg4_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg4_1<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_5<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg5_0<span class="token punctuation">;</span>   
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg5_1<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_10<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_11<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_12<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg6_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg6_1<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_19_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_19_1<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_20_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_20_1<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg7_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg7_1<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_22_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_22_1<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_23_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_23_1<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg8_0<span class="token punctuation">;</span> 
  <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> reg8_1<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> _T_24<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_25<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_28<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _GEN_16<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_31<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_32<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_33<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_34<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_35<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_36<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_37<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_38<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_39<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_40<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_41<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_42<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_43<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_44<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_45<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_46<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_47<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_48<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_49<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_50<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_51<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_52<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_53<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_54<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_55<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_56<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_57<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_58<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_59<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_60<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_61<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_62<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_63<span class="token punctuation">;</span> 
  <span class="token keyword">wire</span>  _T_64<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_5 <span class="token operator">=</span> io_a <span class="token operator">+</span> <span class="token number">8'h1</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_10 <span class="token operator">=</span> io_a <span class="token operator">-</span> <span class="token number">8'h1</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_11 <span class="token operator">=</span> <span class="token kernel-function property">$unsigned</span><span class="token punctuation">(</span>_T_10<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_12 <span class="token operator">=</span> _T_11<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_24 <span class="token operator">=</span> <span class="token operator">~</span> io_a<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_25 <span class="token operator">=</span> _T_24 <span class="token operator">==</span> <span class="token number">8'h0</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_28 <span class="token operator">=</span> io_a <span class="token operator">!=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _GEN_16 <span class="token operator">=</span> reset <span class="token operator">?</span> <span class="token number">1'h0</span> <span class="token punctuation">:</span> <span class="token number">1'h1</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_31 <span class="token operator">=</span> reg0_0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_32 <span class="token operator">=</span> reg1_0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_33 <span class="token operator">=</span> _T_31 <span class="token operator">&amp;</span> _T_32<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_34 <span class="token operator">=</span> reg2_0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_35 <span class="token operator">=</span> _T_33 <span class="token operator">&amp;</span> _T_34<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_36 <span class="token operator">=</span> reg3_0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_37 <span class="token operator">=</span> _T_35 <span class="token operator">&amp;</span> _T_36<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_38 <span class="token operator">=</span> reg4_0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_39 <span class="token operator">=</span> _T_37 <span class="token operator">&amp;</span> _T_38<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_40 <span class="token operator">=</span> reg5_0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_41 <span class="token operator">=</span> _T_39 <span class="token operator">&amp;</span> _T_40<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_42 <span class="token operator">=</span> reg6_0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_43 <span class="token operator">=</span> _T_41 <span class="token operator">&amp;</span> _T_42<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_44 <span class="token operator">=</span> reg7_0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_45 <span class="token operator">=</span> _T_43 <span class="token operator">&amp;</span> _T_44<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_46 <span class="token operator">=</span> reg8_0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_47 <span class="token operator">=</span> _T_45 <span class="token operator">&amp;</span> _T_46<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_48 <span class="token operator">=</span> reg0_1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_49 <span class="token operator">=</span> _T_47 <span class="token operator">&amp;</span> _T_48<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_50 <span class="token operator">=</span> reg1_1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_51 <span class="token operator">=</span> _T_49 <span class="token operator">&amp;</span> _T_50<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_52 <span class="token operator">=</span> reg2_1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_53 <span class="token operator">=</span> _T_51 <span class="token operator">&amp;</span> _T_52<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_54 <span class="token operator">=</span> reg3_1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_55 <span class="token operator">=</span> _T_53 <span class="token operator">&amp;</span> _T_54<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_56 <span class="token operator">=</span> reg4_1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_57 <span class="token operator">=</span> _T_55 <span class="token operator">&amp;</span> _T_56<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_58 <span class="token operator">=</span> reg5_1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_59 <span class="token operator">=</span> _T_57 <span class="token operator">&amp;</span> _T_58<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_60 <span class="token operator">=</span> reg6_1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_61 <span class="token operator">=</span> _T_59 <span class="token operator">&amp;</span> _T_60<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_62 <span class="token operator">=</span> reg7_1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_63 <span class="token operator">=</span> _T_61 <span class="token operator">&amp;</span> _T_62<span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> _T_64 <span class="token operator">=</span> reg8_1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">assign</span> io_c <span class="token operator">=</span> _T_63 <span class="token operator">&amp;</span> _T_64<span class="token punctuation">;</span> 
  
  <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clock<span class="token punctuation">)</span> <span class="token keyword">begin</span>
    reg0_0 <span class="token operator">&lt;=</span> io_a<span class="token punctuation">;</span>
    reg0_1 <span class="token operator">&lt;=</span> io_a<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg1_0 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      reg1_0 <span class="token operator">&lt;=</span> io_a<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg1_1 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      reg1_1 <span class="token operator">&lt;=</span> io_a<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg2_0 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      reg2_0 <span class="token operator">&lt;=</span> <span class="token operator">&#123;&#123;</span><span class="token number">7'd0</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> _T_25<span class="token operator">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg2_1 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      reg2_1 <span class="token operator">&lt;=</span> <span class="token operator">&#123;&#123;</span><span class="token number">7'd0</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> _T_25<span class="token operator">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    reg3_0 <span class="token operator">&lt;=</span> <span class="token operator">&#123;&#123;</span><span class="token number">7'd0</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> _T_28<span class="token operator">&#125;</span><span class="token punctuation">;</span>
    reg3_1 <span class="token operator">&lt;=</span> <span class="token operator">&#123;&#123;</span><span class="token number">7'd0</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> _T_28<span class="token operator">&#125;</span><span class="token punctuation">;</span>
    reg4_0 <span class="token operator">&lt;=</span> <span class="token operator">&#123;&#123;</span><span class="token number">7'd0</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> _GEN_16<span class="token operator">&#125;</span><span class="token punctuation">;</span>
    reg4_1 <span class="token operator">&lt;=</span> <span class="token operator">&#123;&#123;</span><span class="token number">7'd0</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> _GEN_16<span class="token operator">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg5_0 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        reg5_0 <span class="token operator">&lt;=</span> _T_5<span class="token punctuation">;</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg5_1 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        reg5_1 <span class="token operator">&lt;=</span> _T_5<span class="token punctuation">;</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg6_0 <span class="token operator">&lt;=</span> _T_12<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg6_1 <span class="token operator">&lt;=</span> _T_12<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      _T_19_0 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        _T_19_0 <span class="token operator">&lt;=</span> io_a<span class="token punctuation">;</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      _T_19_1 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        _T_19_1 <span class="token operator">&lt;=</span> io_a<span class="token punctuation">;</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      _T_20_0 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        _T_20_0 <span class="token operator">&lt;=</span> _T_19_0<span class="token punctuation">;</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      _T_20_1 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        _T_20_1 <span class="token operator">&lt;=</span> _T_19_1<span class="token punctuation">;</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg7_0 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        reg7_0 <span class="token operator">&lt;=</span> _T_20_0<span class="token punctuation">;</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg7_1 <span class="token operator">&lt;=</span> <span class="token number">8'h0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        reg7_1 <span class="token operator">&lt;=</span> _T_20_1<span class="token punctuation">;</span>
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      _T_22_0 <span class="token operator">&lt;=</span> io_a<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      _T_22_1 <span class="token operator">&lt;=</span> io_a<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      _T_23_0 <span class="token operator">&lt;=</span> _T_22_0<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      _T_23_1 <span class="token operator">&lt;=</span> _T_22_1<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg8_0 <span class="token operator">&lt;=</span> _T_23_0<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>io_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>
      reg8_1 <span class="token operator">&lt;=</span> _T_23_1<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>由生成的Verilog代码可知，当使用寄存器组时，生成的Verilog并不是高维的寄存器形式，而是多个相似命名的寄存器。</p>
<h2 id="测试Testbench"><a href="#测试Testbench" class="headerlink" title="测试Testbench"></a>测试Testbench</h2><p>PeekPokeTester Chisel提供的testbench。</p>
<h2 id="未驱动处理"><a href="#未驱动处理" class="headerlink" title="未驱动处理"></a>未驱动处理</h2><p>未驱动的线网</p>
<p>Chisel的Invalidate API支持检测未驱动的输出型IO以及定义不完整的Wire定义，在编译成firrtl时会产生“not fully initialized”错误。换句话说，就是组合逻辑的真值表不完整，不能综合出完整的电路。如果确实需要不被驱动的线网，则可以赋给一个DontCare对象，这会告诉Firrtl编译器，该线网故意不被驱动。转换成的Verilog会赋予该信号全0值，甚至把逻辑全部优化掉，所以谨慎使用。例如：</p>
<p>val io = IO(new Bundle {<br>    val outs = Output(Vec(10, Bool()))<br>})<br>io.outs &lt;&gt; DontCare<br>1<br>2<br>3<br>4<br>检查机制是由CompileOptions.explicitInvalidate控制的，如果把它设置成true就是严格模式(执行检查)，设置成false就是不严格模式(不执行检查)。</p>
<p>开关方法有两种，第一种是定义一个抽象的模块类，由抽象类设置，其余模块都继承自这个抽象类。例如：<br>// 严格<br>abstract class ExplicitInvalidateModule extends Module()(chisel3.core.ExplicitCompileOptions.NotStrict.copy(explicitInvalidate = true))</p>
<p>// 不严格<br>abstract class ImplicitInvalidateModule extends Module()(chisel3.core.ExplicitCompileOptions.Strict.copy(explicitInvalidate = false))<br>1<br>2<br>3<br>4<br>5<br>第二种方法是在每个模块里重写compileOptions字段，由该字段设置编译选项。例如：<br>// 严格<br>class MyModule extends Module {<br>  override val compileOptions = chisel3.core.ExplicitCompileOptions.NotStrict.copy(explicitInvalidate = true)<br>  …<br>} </p>
<p>// 不严格<br>class MyModule extends Module {<br>  override val compileOptions = chisel3.core.ExplicitCompileOptions.Strict.copy(explicitInvalidate = false)<br>  …<br>}</p>
<h2 id="隐式时钟和隐式复位"><a href="#隐式时钟和隐式复位" class="headerlink" title="隐式时钟和隐式复位"></a>隐式时钟和隐式复位</h2><h2 id="复位"><a href="#复位" class="headerlink" title="复位"></a>复位</h2>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Qingfeng</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://gentlebreezeblow.github.io/2022/01/11/chisel-01/">https://gentlebreezeblow.github.io/2022/01/11/chisel-01/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Qingfeng</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Chisel/">
                                    <span class="chip bg-color">Chisel</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/01/15/Chisel3%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="Chisel3问题记录">
                        
                        <span class="card-title">Chisel3问题记录</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-01-15
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Qingfeng
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Chisel/">
                        <span class="chip bg-color">Chisel</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/01/07/scala-01/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/16.jpg" class="responsive-img" alt="Scala学习">
                        
                        <span class="card-title">Scala学习</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-01-07
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Qingfeng
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Scala/">
                        <span class="chip bg-color">Scala</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <a href="/about" target="_blank">Qingfeng</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
